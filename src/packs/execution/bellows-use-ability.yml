_id: cd1820f5e1a2f6fd
_key: '!macros!cd1820f5e1a2f6fd'
_stats:
  coreVersion: '13'
  lastModifiedBy: teriockBuilder00
  systemId: teriock
  systemVersion: 0.9.17
author: teriockBuilder00
command: |-
  const data = /** @type {Teriock.HookData.UseAbility} */ scope.data;
  const dealsDamage = data.execution.message?.system.buttons.some(
    (b) =>
      b.dataset.action === "roll-rollable-take" && b.dataset.type === "damage",
  );
  if (data.execution.source.system.spell && dealsDamage) {
    const bellowsIds = data.execution.actor?.effects
      .filter((c) => c.name === "Bellows Effect" && c.type === "consequence")
      .map((c) => c.id);
    if (bellowsIds && bellowsIds.length > 0) {
      await data.execution.actor?.deleteEmbeddedDocuments(
        "ActiveEffect",
        bellowsIds,
      );
    }
  }
img: icons/svg/dice-target.svg
name: Bellows - Use Ability
scope: global
type: script
