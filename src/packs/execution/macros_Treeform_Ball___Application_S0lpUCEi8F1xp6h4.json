{
  "name": "Treeform Ball - Application",
  "type": "script",
  "_id": "S0lpUCEi8F1xp6h4",
  "author": "Z8sCTHO0edFF1hYo",
  "img": "icons/svg/dice-target.svg",
  "scope": "global",
  "command": "if (!actor.effectKeys.consequence?.has(\"treeformBallEffect\")) {\n  const hp = actor.system.hp.value;\n  if (!actor.itemKeys.species.has(\"tree\")) {\n    const treeSpecies = await game.teriock.api.fetch.getItem(\n      \"Tree\",\n      \"species\",\n      {\n        clone: true,\n      },\n    );\n    const created = await actor.createEmbeddedDocuments(\"Item\", [treeSpecies]);\n    const createdTree = created[0];\n    await createdTree.update({\n      \"system.size.value\": actor.system.size,\n      \"system.applyMp\": false,\n    });\n  }\n  const notTree = actor.species.filter((s) => s.name !== \"Tree\");\n  const disabledSpeciesArray = notTree.map((s) => {\n    return {\n      _id: s.id,\n      \"system.applyHp\": false,\n      \"system.disabled\": true,\n    };\n  });\n  const disabledRanksArray = actor.ranks.map((r) => {\n    return {\n      _id: r.id,\n      \"system.disabled\": true,\n    };\n  });\n  const itemsToDisable = [...disabledSpeciesArray, ...disabledRanksArray];\n  await actor.updateEmbeddedDocuments(\"Item\", itemsToDisable);\n  await actor.setFlag(\"teriock\", \"preTransformHp\", hp);\n  await actor.update({ \"system.hp.value\": actor.system.hp.max });\n}",
  "folder": null,
  "sort": 0,
  "ownership": {
    "default": 0,
    "Z8sCTHO0edFF1hYo": 3
  },
  "flags": {},
  "_stats": {
    "compendiumSource": null,
    "duplicateSource": null,
    "exportSource": null,
    "coreVersion": "13.345",
    "systemId": "teriock",
    "systemVersion": "0.1.0",
    "createdTime": 1756416745939,
    "modifiedTime": 1756422960008,
    "lastModifiedBy": "Z8sCTHO0edFF1hYo"
  },
  "_key": "!macros!S0lpUCEi8F1xp6h4"
}
