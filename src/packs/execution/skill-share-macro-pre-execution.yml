name: Skill Share Macro - Pre-execution
type: script
_id: xERvcMl0jyZHu960
author: teriockBuilder00
img: icons/svg/dice-target.svg
scope: global
command: |-
  const data = /** @type {Teriock.HookData.UseAbility} */ scope.data;
  const buttons = data.rollConfig.chatData.system.buttons;
  data.rollConfig.chatData.system.buttons = buttons.filter(
    (button) => button.dataset.action === "apply-effect",
  );
  const button = data.rollConfig.chatData.system.buttons[0];
  const effectObject = JSON.parse(button.dataset.normal);
  const validAbilities = actor.abilities
    .filter((a) => !a.isReference && a.system.standard)
    .sort((a, b) => a.name.localeCompare(b.name));
  const ability = await tm.dialogs.selectDocumentDialog(
    validAbilities,
    {
      title: "Select Ability",
      hint: "Select an ability to share.",
    },
  );
  effectObject.system.hierarchy.rootUuid = ability.system.hierarchy.rootUuid;
  effectObject.system.hierarchy.subIds = [ability.id];
  const effectString = JSON.stringify(effectObject);
  data.rollConfig.chatData.system.buttons[0].dataset.normal = effectString;
  data.rollConfig.chatData.system.buttons[0].dataset.crit = effectString;
  data.rollConfig.chatData.system.proficient = false;
  data.rollConfig.chatData.system.fluent = false;
folder: null
ownership:
  default: 0
flags: {}
_stats:
  coreVersion: '13.345'
  systemId: teriock
  systemVersion: 0.1.0
  lastModifiedBy: teriockBuilder00
_key: '!macros!xERvcMl0jyZHu960'
