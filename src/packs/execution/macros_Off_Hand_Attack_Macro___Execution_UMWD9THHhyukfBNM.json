{
  "name": "Off-Hand Attack Macro - Execution",
  "type": "script",
  "_id": "UMWD9THHhyukfBNM",
  "author": "MMeF1yfOcMgtpZFS",
  "img": "icons/svg/dice-target.svg",
  "scope": "global",
  "command": "const options = foundry.utils.deepClone(scope.useData.rollOptions);\nconst actor = scope.abilityData.actor;\nconst equipment = actor.equipment.filter(\n  (e) =>\n    e.system.equipped &&\n    e.system.damage &&\n    e.system.damage !== \"0\" &&\n    actor.system.wielding.attacker.raw !== e.id,\n);\nconst selectedEquipmentUuids = await game.teriock.api.dialog.selectDocument(\n  equipment,\n  {\n    title: \"Select Equipment\",\n    hint: \"Select equipment to attack with.\",\n    multi: false,\n    tooltip: true,\n  },\n);\nconst selectedEquipment = await foundry.utils.fromUuid(\n  selectedEquipmentUuids[0],\n);\nconst selectedEquipmentId = selectedEquipment.id;\nconst oldEquipmentId = actor.system.wielding.attacker.raw;\nawait actor.update({\n  \"system.wielding.attacker.raw\": selectedEquipmentId,\n});\nconst abilities = actor.abilities\n  .filter(\n    (a) =>\n      a.system.interaction === \"attack\" &&\n      a.system.maneuver === \"active\" &&\n      a.system.executionTime === \"a1\" &&\n      [\"weapon\", \"hand\"].includes(a.system.delivery.base),\n  )\n  .sort((a, b) => a.name.localeCompare(b.name));\nconst selectedAbilities = await game.teriock.api.dialog.selectDocument(\n  abilities,\n  {\n    title: \"Select Ability\",\n    hint: \"Select an ability to use.\",\n    multi: false,\n    tooltip: true,\n  },\n);\nconst ability = await foundry.utils.fromUuid(selectedAbilities[0]);\nawait ability.system.roll(options);\nawait actor.update({\n  \"system.wielding.attacker.raw\": oldEquipmentId,\n});",
  "folder": null,
  "sort": 0,
  "ownership": {
    "default": 0,
    "MMeF1yfOcMgtpZFS": 3
  },
  "flags": {},
  "_stats": {
    "compendiumSource": null,
    "duplicateSource": null,
    "exportSource": null,
    "coreVersion": "13.345",
    "systemId": "teriock",
    "systemVersion": "0.1.0",
    "createdTime": 1754705501955,
    "modifiedTime": 1754856393581,
    "lastModifiedBy": "MMeF1yfOcMgtpZFS"
  },
  "_key": "!macros!UMWD9THHhyukfBNM"
}
