name: Resist Effects - Pre-execution
type: script
_id: 5AsyrTgmr9NrD3XS
author: teriockBuilder00
img: icons/svg/dice-target.svg
scope: global
command: |-
  const data = /** @type {Teriock.HookData.UseAbility} */ scope.data;
  const buttons = data.execution.buttons;
  const applyButton = buttons.find((b) => b.label === "Apply Effect");

  const choices = {
    awakening: "Awakening",
    control: "Control",
    displacement: "Displacement",
    duelModifying: "Duel modifying",
    financial: "Financial",
    healing: "Healing",
    killing: "Killing",
    knockout: "Knockout",
    loud: "Loud",
    mental: "Mental",
    poison: "Poison",
    reanimation: "Reanimation",
    regeneration: "Regeneration",
    revitalization: "Revitalization",
    revival: "Revival",
    stealing: "Stealing",
    summoning: "Summoning",
    temporal: "Temporal",
    transformation: "Transformation",
    truthDetecting: "Truth detecting",
  };

  const documents = Object.entries(choices).map(([uuid, name]) => {
    const img = tm.path.getImage("effect-types", name);
    return { img, name, uuid };
  });

  const choice = await tm.dialogs.selectDocumentDialog(documents, {
    hint: "Select an effect type to resist.",
  });

  function modifyData(data) {
    const effectObject = JSON.parse(data);
    effectObject.changes.push({
      key: "system.protections.resistances.effects",
      value: choice.uuid,
      mode: 2,
      priority: 10,
    });
    return JSON.stringify(effectObject);
  }

  applyButton.dataset.normal = modifyData(applyButton.dataset.normal);
  applyButton.dataset.crit = modifyData(applyButton.dataset.crit);
flags: {}
_stats:
  coreVersion: '13'
  systemId: teriock
  systemVersion: 0.1.0
  lastModifiedBy: teriockBuilder00
  compendiumSource: null
_key: '!macros!5AsyrTgmr9NrD3XS'
