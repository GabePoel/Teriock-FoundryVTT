{
  "name": "Self Revert Macro - Pre-execution",
  "type": "script",
  "_id": "dc0XWbqZgw04rJn5",
  "author": "Z8sCTHO0edFF1hYo",
  "img": "icons/svg/dice-target.svg",
  "scope": "global",
  "command": "const data = /** @type {Teriock.HookData.UseAbility} */ scope.data;\nconst transformationLevels = {\n  minor: \"Minor Transformation\",\n  full: \"Full Transformation\",\n  greater: \"Greater Transformation\",\n};\nconst chosenTransformationLevel = await game.teriock.api.dialogs.selectDialog(\n  transformationLevels,\n  {\n    label: \"Level\",\n    hint: \"If known, select the level of transformation you are attempting to revert from.\",\n    title: \"Select Transformation Level\",\n    other: true,\n    initial: \"minor\",\n  },\n);\nlet dc = \"none\";\nif (chosenTransformationLevel === \"minor\") dc = 6;\nif (chosenTransformationLevel === \"full\") dc = 12;\nif (chosenTransformationLevel === \"greater\") dc = 18;\nconst buttons = data.rollConfig.chatData.system.buttons.filter(\n  (b) => b.dataset?.action === \"feat-save\" && b.dataset?.attribute === \"int\",\n);\nfor (const b of buttons) {\n  b.dataset.dc = dc;\n}\nfor (let i = 0; i < data.rollConfig.chatData.rolls.length; i++) {\n  const r = data.rollConfig.chatData.rolls[i];\n  if (r.context?.diceClass === \"feat\") {\n    if (typeof dc === \"number\") {\n      const newRoll = new game.teriock.Roll(\n        `${dc}`,\n        {},\n        {\n          flavor: transformationLevels[chosenTransformationLevel] + \" DC\",\n          context: {\n            diceClass: \"feat\",\n            totalClass: \"feat\",\n          },\n        },\n      );\n      await newRoll.evaluate();\n      data.rollConfig.chatData.rolls[i] = newRoll;\n    } else {\n      data.rollConfig.chatData.rolls.pop();\n    }\n  }\n}",
  "folder": null,
  "sort": 2300000,
  "ownership": {
    "default": 0,
    "Z8sCTHO0edFF1hYo": 3
  },
  "flags": {},
  "_stats": {
    "compendiumSource": null,
    "duplicateSource": null,
    "exportSource": null,
    "coreVersion": "13.345",
    "systemId": "teriock",
    "systemVersion": "0.1.0",
    "createdTime": 1756590445578,
    "modifiedTime": 1757058247252,
    "lastModifiedBy": "Z8sCTHO0edFF1hYo"
  },
  "_key": "!macros!dc0XWbqZgw04rJn5"
}
