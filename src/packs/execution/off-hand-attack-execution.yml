_id: 29b994da873c13a9
_key: '!macros!29b994da873c13a9'
_stats:
  coreVersion: '13'
  lastModifiedBy: teriockBuilder00
  systemId: teriock
  systemVersion: 0.9.17
author: teriockBuilder00
command: |-
  const data = /** @type {Teriock.HookData.UseAbility} */ scope.data;
  const options = data.execution.options;
  const actor = data.execution.actor;
  const armaments = actor.activeArmaments.filter(
    (e) => actor.system.primaryAttacker !== e.id,
  );
  if (armaments.length > 0) {
    const selectedArmament = await tm.dialogs.selectDocumentDialog(armaments, {
      hint: game.i18n.localize("TERIOCK.DIALOGS.Select.Armament.hint"),
      title: game.i18n.localize("TERIOCK.DIALOGS.Select.Armament.title"),
    });
    let abilities = await actor.allAbilities();
    abilities = abilities
      .filter(
        (a) =>
          a.system.interaction === "attack" &&
          a.system.maneuver === "active" &&
          a.system.executionTime === "a1" &&
          ["weapon", "hand"].includes(a.system.delivery.base),
      )
      .sort((a, b) => a.name.localeCompare(b.name));
    const ability = await tm.dialogs.selectDocumentDialog(abilities, {
      hint: game.i18n.localize("TERIOCK.DIALOGS.Select.Ability.hint"),
      title: game.i18n.localize("TERIOCK.DIALOGS.Select.Ability.title"),
    });
    options.armament = selectedArmament;
    await ability.system.use(options);
  }
img: icons/svg/dice-target.svg
name: Off-Hand Attack - Execution
scope: global
type: script
