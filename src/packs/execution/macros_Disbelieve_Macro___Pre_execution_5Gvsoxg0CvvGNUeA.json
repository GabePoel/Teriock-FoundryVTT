{
  "name": "Disbelieve Macro - Pre-execution",
  "type": "script",
  "_id": "5Gvsoxg0CvvGNUeA",
  "author": "Z8sCTHO0edFF1hYo",
  "img": "icons/svg/dice-target.svg",
  "scope": "global",
  "command": "const data = /** @type {Teriock.HookData.UseAbility} */ scope.data;\nconst illusionLevels = {\n  minor: \"Minor Illusion\",\n  full: \"Full Illusion\",\n  greater: \"Greater Illusion\",\n};\nconst chosenIllusionLevel = await game.teriock.api.dialogs.selectDialog(\n  illusionLevels,\n  {\n    label: \"Level\",\n    hint: \"If known, select the level of illusion you are attempting to disbelieve.\",\n    title: \"Select Illusion Level\",\n    other: true,\n    initial: \"minor\",\n  },\n);\nlet dc = \"none\";\nif (chosenIllusionLevel === \"minor\") dc = 6;\nif (chosenIllusionLevel === \"full\") dc = 12;\nif (chosenIllusionLevel === \"greater\") dc = 18;\nconst buttons = data.rollConfig.chatData.system.buttons.filter(\n  (b) => b.dataset?.action === \"feat-save\" && b.dataset?.attribute === \"int\",\n);\nif (typeof dc === \"number\") {\n  for (const b of buttons) {\n    b.dataset.dc = `${dc - 2 * data.rollConfig.useData.modifiers.heightened}`;\n  }\n}\nfor (let i = 0; i < data.rollConfig.chatData.rolls.length; i++) {\n  const r = data.rollConfig.chatData.rolls[i];\n  if (r.context?.diceClass === \"feat\") {\n    if (typeof dc === \"number\") {\n      const newRoll = new game.teriock.Roll(\n        `${dc} - 2 * @h`,\n        data.rollConfig.useData.rollData,\n        {\n          flavor: illusionLevels[chosenIllusionLevel] + \" DC\",\n          context: {\n            diceClass: \"feat\",\n            totalClass: \"feat\",\n          },\n        },\n      );\n      await newRoll.evaluate();\n      data.rollConfig.chatData.rolls[i] = newRoll;\n    } else {\n      data.rollConfig.chatData.rolls.pop();\n    }\n  }\n}",
  "folder": null,
  "sort": 300000,
  "ownership": {
    "default": 0,
    "Z8sCTHO0edFF1hYo": 3
  },
  "flags": {},
  "_stats": {
    "compendiumSource": null,
    "duplicateSource": null,
    "exportSource": null,
    "coreVersion": "13.345",
    "systemId": "teriock",
    "systemVersion": "0.1.0",
    "createdTime": 1756593859308,
    "modifiedTime": 1757058247252,
    "lastModifiedBy": "Z8sCTHO0edFF1hYo"
  },
  "_key": "!macros!5Gvsoxg0CvvGNUeA"
}
