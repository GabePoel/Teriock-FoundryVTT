_id: ce7e68b1e3f9dd74
_key: '!macros!ce7e68b1e3f9dd74'
_stats:
  coreVersion: '13'
  lastModifiedBy: teriockBuilder00
  systemId: teriock
  systemVersion: 0.9.17
author: teriockBuilder00
command: |-
  const data = /** @type {Teriock.HookData.TakeNumeric} */ scope.data;
  if (data.amount >= actor.system.hp.value + actor.system.hp.temp) {
    const carry = data.amount - actor.system.hp.value - actor.system.hp.temp;
    const treeformConsequences = actor.consequences.filter(
      (c) =>
        c.name ===
        game.i18n.format("TERIOCK.SYSTEMS.Ability.EXECUTION.effectName", {
          name: TERIOCK.reference.abilities.treeformBall,
        }),
    );
    for (const c of treeformConsequences) {
      await c.system.expire();
    }
    data.cancel = true;
    await actor.system.takeDamage(carry);
  }
img: icons/svg/dice-target.svg
name: Treeform Ball - Damage
scope: global
type: script
