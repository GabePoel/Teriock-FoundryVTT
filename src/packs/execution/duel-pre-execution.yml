_id: duelPreExecution
_key: '!macros!duelPreExecution'
_stats:
  coreVersion: '13'
  lastModifiedBy: teriockBuilder00
  systemId: teriock
  systemVersion: 0.9.16
author: teriockBuilder00
command: |-
  const data = /** @type {Teriock.HookData.UseAbility} */ scope.data;
  const buttons = data.execution.buttons;
  const applyButton = buttons.find((b) => b.label === "Apply Effect");
  applyButton.label = "Apply Lighted";

  const token = actor?.defaultToken?.document || actor;

  function modifyData(data) {
    const effectObject = JSON.parse(data);
    effectObject.description = "<ul>";
    effectObject.system.impacts.changes.push({
      key: "system.trackers.lighted",
      value: token.uuid || actor.uuid,
      mode: 2,
      priority: 10,
    });
    effectObject.description += `<li>Lighted to @UUID[${token.uuid}]{${token.name}}</li>`;
    effectObject.description += "</ul>";
    return JSON.stringify(effectObject);
  }

  applyButton.dataset.normal = modifyData(applyButton.dataset.normal);
  applyButton.dataset.crit = modifyData(applyButton.dataset.crit);
img: icons/svg/dice-target.svg
name: Duel - Pre-execution
scope: global
type: script
