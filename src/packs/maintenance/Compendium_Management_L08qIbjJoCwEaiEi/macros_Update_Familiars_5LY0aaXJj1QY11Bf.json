{
  "folder": "L08qIbjJoCwEaiEi",
  "name": "Update Familiars",
  "type": "script",
  "_id": "5LY0aaXJj1QY11Bf",
  "author": "Z8sCTHO0edFF1hYo",
  "img": "icons/svg/mole.svg",
  "scope": "global",
  "command": "const powersPack = game.teriock.packs.powers();\nconst familiarsFolder = powersPack.folders.getName(\"Familiars\");\n\nlet commonAnimalPages = await game.teriock.api.wiki.fetchCategoryMembers(\n  \"Common animal creatures\",\n);\ncommonAnimalPages = commonAnimalPages.filter((page) =>\n  page.title.includes(\"Creature:\"),\n);\n\nfor (const page of commonAnimalPages) {\n  const animal = page.title.split(\"Creature:\")[1];\n  const html = await game.teriock.api.wiki.fetchWikiPageHTML(page.title);\n  const doc = new DOMParser().parseFromString(html, \"text/html\");\n  doc.querySelector(\".expandable-table\").remove();\n  const subs = Array.from(doc.querySelectorAll(\".expandable-container\")).filter(\n    (el) => !el.closest(\".expandable-container:not(:scope)\"),\n  );\n  console.log(subs);\n  const name = animal + \" Familiar\";\n  let familiarItem = powersPack.index.find((p) => p.name === name);\n  if (!familiarItem) {\n    familiarItem = await game.teriock.Item.create(\n      {\n        folder: familiarsFolder.id,\n        img: \"systems/teriock/src/icons/abilities/familiar-bond.webp\",\n        name: name,\n        system: {\n          type: \"familiar\",\n        },\n        type: \"power\",\n      },\n      { pack: \"teriock.powers\" },\n    );\n  } else {\n    familiarItem = await foundry.utils.fromUuid(familiarItem.uuid);\n  }\n  await familiarItem.deleteEmbeddedDocuments(\n    \"ActiveEffect\",\n    familiarItem.abilities.map((a) => a.id),\n  );\n  console.log(familiarItem);\n  await game.teriock.data.shared.parsing.processSubAbilities(\n    subs,\n    familiarItem,\n  );\n}",
  "sort": 0,
  "ownership": {
    "default": 0,
    "Z8sCTHO0edFF1hYo": 3
  },
  "flags": {},
  "_stats": {
    "compendiumSource": null,
    "duplicateSource": null,
    "exportSource": null,
    "coreVersion": "13.345",
    "systemId": "teriock",
    "systemVersion": "0.1.0",
    "createdTime": 1756617980060,
    "modifiedTime": 1756620047467,
    "lastModifiedBy": "Z8sCTHO0edFF1hYo"
  },
  "_key": "!macros!5LY0aaXJj1QY11Bf"
}
