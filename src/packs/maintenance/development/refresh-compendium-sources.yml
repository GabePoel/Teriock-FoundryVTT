folder: L08qIbjJoCwEaiEi
name: Refresh Compendium Sources
type: script
_id: ND6JVDvV6XlIpqOr
author: teriockBuilder00
img: icons/svg/padlock.svg
scope: global
command: |-
  await tm.utils.progressBar(
    game.packs.contents.filter((p) => p.collection !== "teriock.creatures"),
    "Refreshing Compendium Sources",
    /** @param {TeriockCompendiumCollection<TeriockDocument>} p */ async (p) => {
      if (!p.locked) {
        await p.getIndex();
        const indexes = tm.sort.docSort(
          p.index.contents.filter((d) => !d?.system?._sup),
        );
        await tm.utils.progressBar(
          indexes,
          `Refreshing ${p.title} Sources`,
          async (i) => {
            const doc = await tm.resolve.resolveDocument(i);
            if (["Actor", "ActiveEffect", "Item"].includes(doc.documentName)) {
              await tm.resolve.inferChildCompendiumSources(doc);
            }
          },
          { batch: 50 },
        );
      }
    },
  );
flags: {}
_stats:
  compendiumSource: null
  coreVersion: '13'
  systemId: teriock
  systemVersion: 0.9.1
  lastModifiedBy: teriockBuilder00
_key: '!macros!ND6JVDvV6XlIpqOr'
