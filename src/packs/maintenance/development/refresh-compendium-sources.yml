folder: L08qIbjJoCwEaiEi
name: Refresh Compendium Sources
type: script
_id: ND6JVDvV6XlIpqOr
author: teriockBuilder00
img: icons/svg/padlock.svg
scope: global
command: |-
  let packPct = 0;
  const packProgress = ui.notifications.info("Refreshing Compendium Sources", {
    pct: packPct,
    progress: true,
  });
  const packs = game.packs.contents.filter(
    (p) => p.collection !== "teriock.creatures",
  );
  for (const p of packs) {
    packPct += 1 / packs.length;
    packProgress.update({
      message: `Refreshing ${p.title}`,
      pct: packPct,
    });
    await p.getIndex();
    const indexes = tm.utils.docSort(
      p.index.contents.filter((d) => !d?.system?._sup),
    );
    let indexPct = 0;
    const indexProgress = ui.notifications.info("Refreshing Documents", {
      pct: indexPct,
      progress: true,
    });
    for (const index of indexes) {
      indexPct += 1 / indexes.length;
      indexProgress.update({
        message: `Refreshing ${index.name}`,
        pct: indexPct,
      });
      const doc = await tm.utils.resolveDocument(index);
      if (["Actor", "ActiveEffect", "Item"].includes(doc.documentName)) {
        await tm.utils.inferChildCompendiumSources(doc);
      }
    }
    indexProgress.update({ pct: 1 });
  }
  packProgress.update({ pct: 1 });
flags: {}
_stats:
  compendiumSource: null
  coreVersion: '13'
  systemId: teriock
  systemVersion: 0.9.1
  lastModifiedBy: teriockBuilder00
_key: '!macros!ND6JVDvV6XlIpqOr'
