_id: inferCompendiumS
_key: '!macros!inferCompendiumS'
_stats:
  coreVersion: '13'
  lastModifiedBy: teriockBuilder00
  systemId: teriock
  systemVersion: 0.9.16
author: teriockBuilder00
command: |-
  await tm.utils.progressBar(
    await tm.dialogs.selectCompendiumsDialog(),
    "Refreshing Compendium Sources",
    /** @param {TeriockCompendiumCollection<TeriockDocument>} p */ async (p) => {
      if (!p.locked) {
        await p.getIndex();
        const indexes = tm.sort.docSort(
          p.index.contents.filter((d) => !d?.system?._sup),
        );
        await tm.utils.progressBar(
          indexes,
          `Refreshing ${p.title} Sources`,
          async (i) => {
            const doc = await tm.resolve.resolveDocument(i);
            if (doc.documentMetadata.common) {
              await tm.resolve.inferChildCompendiumSources(doc);
            }
          },
          { batch: 50 },
        );
      }
    },
  );
folder: development00000
img: icons/svg/light.svg
name: Infer Compendium Sources
scope: global
type: script
